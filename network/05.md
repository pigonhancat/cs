# ARP

## ARP 프로토콜

### ARP가 하는 일

- 3계층이라 같은 네트워크 대역에서만 사용됨
    - 3계층 장비(공유기 등)은 브로드캐스트가 오면 외부로 보내지 않고 그 패킷을 버림
- 같은 LAN 네트워크 대역에서 통신을 하기 위해 필요한 MAC 주소를 IP 주소를 이용해서 알아오는 프로토콜
- 같은 네트워크 대역에서 통신을 하더라도 데이터를 보내기 위해서 7계층부터 캡슐화를 통해 데이터를 보내기 때문에 IP주소와 MAC 주소가 모두 필요함
- 이 때 IP 주소는 알고 MAC 주소는 모르더라도 ARP를 통해 통신이 가능

### ARP 프로토콜의 구조

- 28바이트
- 구조
    - Hardware type(2바이트)
        - 2계층에서 사용하는 프로토콜(대부분 Ethernet(0x0001))
    - Protocol type(2바이트)
        - 대부분 IPv4(0x0800)
    - Hardware Address Length(1바이트)
        - 대부분 MAC 주소의 길이(0x06)
    - Protocol Address Length(1바이트)
        - 대부분 IPv4 길이(0x04)
    - Opcode(2바이트)
        - 명령어 코드(요청(0x0001), 응답(0x0002))
    - Source Hardware Addresss(6바이트)
        - 출발지 MAC 주소
    - Source Protocol Address(4바이트)
        - 출발지 IP 주소
    - Destination Hardware Address(6바이트)
        - 도착지 MAC 주소
    - Destination Protocol Address(4바이트)
        - 도착지 IP 주소

## ARP 프로토콜의 통신 과정

### IP 주소로 MAC주소를 알아오는 과정

1. 요청 컴퓨터 요청
    - Ethernet + ARP
        - 근데 여기서 Ethernet과 ARP는 MAC 주소를 알고 있어야 하는 데 몰라서 보내는 것임
        - ARP : 목적지 MAC 주소 부분을 전부 0으로(0x0000000000)  채움, 목적지 IP 주소는 알고 있으니 그대로
        - Ethernet : 목적지 MAC 주소 부분을 1로 채움(0xFFFFFFFFFFFF)
        - 스위치는 2계층 장비이기 때문에 2계층까지만 해석(디캡슐화) 가능(Ethernet)
        - 브로드캐스트 주소(즉, 스위치를 통해 같은 대역의 요청을 보낸 컴퓨터를 제외한 모든 컴퓨터한테 보냄)
        - 요청을 보낸 컴퓨터를 제외한 모든 컴퓨터는 3계층까지 해석해서, 자기랑 요청의 도착지 IP 주소가 일치하지 않으면 버림
2. 일치할 경우, 응답 컴퓨터 응답
    - Ethernet + ARP
        - 완전함(상대의 MAC과 IP를 알기 때문)
        - 스위치가 해석해서 요청했던 컴퓨터에게만 보냄
3. 요청 컴퓨터도 이제 MAC 주소를 알게 되었음
    - 요청 컴퓨터느 ARP 캐시 테이블에 IP와 MAC 주소를 매핑시킨 정보를 저장함
- 지금까지가 최초의 통신이고 그 다음부터 하고 싶은 통신을 함

## ARP 테이블

### 나와 통신했던 컴퓨터들

- 캐시라 일정 시간이 지나면 매핑 정보가 사라짐
    - 영구적으로 등록하려면 직접 등록해야 함

## 실습

### ARP 테이블 확인 및 분석

```cmd
arp -a
```

- Wireshark
    - Info에 ?가 달려 있는 것은 요청하는 것(안 달려 있는 것은 응답하는 것)
- 패딩은 프레임의 최소 바이트(60바이트)를 채우기 위해 있는 것
    - 없어 보이는 경우는 패딩이 붙기 전 패킷 캡쳐 시점 때문
    - 최대 바이트(가변적이지만 보통 1514바이트)