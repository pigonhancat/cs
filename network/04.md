# 3계층

## 3계층의 기능

### 3계층에서 하는 일

- 다른 네트워크 대역, 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어하는 일을 담당
- 서로 다른 LAN과 LAN 대역을 연결하는 역할 (WAN)
- 라우터 같은 3계층 장비가 필요
- 발신에서 착신까지의 패킷의 경로를 제어

### 3계층에서 쓰는 주소, IP 주소

- WAN에서 통신할 때 사용하는 주소

### 3계층 프로토콜

- ARP 프로토콜
    - IP 주소를 이용해 MAC주소를 알아오는 프로토콜
- IPv4 프로토콜
    - WAN에서 통신할 때 사용하는 프로토콜
    - 20바이트
- ICMP 프로토콜
    - 서로가 통신되는지 확인할 때 사용하는 프로토콜

## 일반적인 IP 주소

- .으로 구분, 4 덩어리
- 4바이트
- 10진수
- 한 덩어리가 1바이트(표현 범위 : 0 ~ 255, 0x00 ~ 0xff)
- classful -> classlessful -> 공인/사설 ip

### Classful IP 주소

- 초창기
- 낭비가 심함

|클래스|네트워크 구분|시작 주소|마지막 주소|
|:---:|:---:|:---:|:---:|
|A클래스|0XXXXXXX, 첫번째 필드|0.0.0.0|127.255.255.255|
|B클래스|10XXXXXX, 두번째 필드|128.0.0.0|191.255.255.255|
|C클래스|110XXXXX, 세번째 필드|192.0.0.0|223.255.255.255|
|D클래스 (멀티캐스트)|1110XXXX|224.0.0.0|239.255.255.255|
|E클래스 (예약)|1111XXXX|240.0.0.0|255.255.255.255|

- 가능한 네트워크 대역 갯수/한 네트워크에 가능한 노드 갯수
- A클래스
    - 0 0000000/00000000.00000000.00000000 ~ 0 1111111/11111111.11111111.11111111
    - 가능한 A클래스 네트워크 대역 갯수 : 128개 (00000000 ~ 01111111)
- B클래스
    - 10 000000.00000000/00000000.00000000 ~ 10 111111.11111111/11111111.11111111
    - 가능한 B클래스 네트워크 대역 갯수 : (10000000 00000000 ~ 10111111 11111111)
- C클래스
    - 110 00000.00000000.00000000/00000000 ~ 110 11111.11111111.11111111/11111111
    - 가능한 C클래스 네트워크 대역 갯수 : (11000000 00000000 00000000 ~ 11011111 11111111 11111111)
- D클래스
    - 1110 0000.00000000.00000000.00000000 ~ 1110 1111.11111111.11111111.11111111
- E클래스
    - 11110 000.00000000.00000000.00000000 ~ 11111111.11111111.11111111.11111111

### Classfulless IP 주소

- Classful보다 낭비되지 않도록 아껴쓰기 위한 방식

- 192.168.32.189/26
    - IP 주소 
        - 192.168.32.189
    - 서브넷 마스크
        - 클래스풀한 네트워크 대역을 나눠주는데 사용하는 값
        - 어디까지가 네트워크 대역을 구분하는데 사용하고 어디서부터 호스트를 구분하는데 사용하는지 지정
        - 2진수로 표기했을 때 1로 시작, 1과 1 사이에는 0이 올 수 없다는 규칙이 존재
        - 4바이트
        - 255.255.255.192(11111111.11111111.11111111.11000000)
        - 1로 되있는 부분이 네트워크 대역을 구분하기 위한 영역, 나머지 부분은 노드를 구별하기 위해 사용
    - 네트워크 ID
        - 192.168.32.128
    - 브로드캐스트 주소
        - 192.168.32.191
    - 사용 가능 IP 범위
        - 192.168.32.129  ~ 192.168.32.190

### 사설 IP와 공인 IP

- 현재 IPv4의 개념 + classless 개념
- 공인 IP 1개당 사설 IP 2^32개(0.0.0.0 ~ 255.255.255.255)
- 공인 IP
    - 인터넷
- 사설 IP
    - 같은 네트워크에서 사용
    - 사설 IP 대역을 사용하는 장비는 공인 IP 장비(공유기)를 걸쳐야만 인터넷(다른 네트워크와 통신할 때)을 통해야만 통신 가능(공인 IP로 바꿔서 나감)
- 외부에서는 공유기에 할당된 공인 IP로만 구별할 수 있음 -> 공유기가 구분해서 사설 IP로 다시 바꿔줌
- NAT(Network Area Translation, 특정 ip를 다른 ip로 바꾸는 기술)를 사용(NAT 테이블에 요청을 기록해서 응답이 왔을 때, 해당 노드에 전달, 테이블에 없는 요청이 올 경우, 그냥 공유기가 받고 끝남(컴퓨터에 전달해주지 않음))
- 그래서 서버는 사설 IP를 잘 사용하지 않고 공인 IP를 사용, 포트포워딩 설정을 해줘야만 네트워크 밖에서 네트워크 내부로 들어올 수 있음
- 실제 인터넷에서는 공인IP로만 통신하기 때문에 외부 네트워크 대역에서는 사설 IP 대역이 보이지 않음


## 특수한 IP 주소

### 0.0.0.0

- Wildcard
- 나머지 모든 IP

### 127.0.0.1

- 자신을 나타내는 주소

### 게이트웨이 주소

- 외부 네트워크로 가려면 일단 여기
- 일반적으로 공유기의 IP 사용
- 사용할 수 있는 IP 중 가장 크거나 작은 값을 사용
- IP주소와 서버넷 마스크는 나를 구분하는 데 사용, 기본 게이트웨이는 외부로 나가는 문의 위치(설정하지 않을 경우, 인터넷을 못 함)

## 실습

### IP 주소 알아보기

```cmd
ipconfig

rem 해당 ip는 사설 ip / 공인 ip를 확인하고 싶으면 네이버에 내 ip 주소
rem IPv4 : 현재 PC에 할당된 IP 주소
rem 서브넷 마스크 : IP 주소에 대한 네트워크의 대역을 규정하는 것
rem 게이트웨이 주소 : 외부와 통신할 때 사용하는 네트워크의 출입구
rem WAN 통신을 위한 최소한의 조건(IP, 서브넷 마스크, 게이트웨이 주소)
```